services:
  alloy:
    image: grafana/alloy:v1.12.1
    environment:
      OTEL_PASSWORD: ${OTEL_PASSWORD}
    command: >
      run
      --server.http.listen-addr=0.0.0.0:12345
      --storage.path=/var/lib/alloy/data
      /etc/alloy/config.alloy
    volumes:
       - ./alloy/config.alloy:/etc/alloy/config.alloy
       - /var/run/docker.sock:/var/run/docker.sock
      # - ./.data/alloy:/var/lib/alloy/data
    # depends_on:
    #   loki:
    #     condition: service_healthy
    networks:
      - observability
    extra_hosts:
      - "host.docker.internal:host-gateway"